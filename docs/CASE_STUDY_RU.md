# Публичный кейс: как ускорили WhisperMac без потери качества

## Контекст

Проблема: длинные голосовые заметки транскрибировались слишком долго после нажатия stop.

Цель: ускорить финализацию диктовки без деградации качества текста.

## Что изменили

1. Переписали streaming-воркер под incremental ingestion:
- больше нет постоянной конкатенации всего массива аудио;
- обрабатываются только новые чанки.

2. Добавили backlog flush после stop:
- если модель не успела во время записи, хвост догоняется кусками, а не одной тяжёлой операцией.

3. Включили adaptive final pass:
- полный проход по всему аудио делается только при признаках проблем;
- очень длинные записи не проходят второй full-pass целиком.

4. Добавили фильтр тишины:
- короткие шумовые/галлюцинаторные сегменты отбрасываются по `no_speech_prob`.

5. Добавили телеметрию производительности:
- `RTF` и время обработки пишутся в `~/whisper_perf.log`.

## Принципы, которые можно переиспользовать

- Не ре-декодировать всё, если можно декодировать только дельту.
- Качество-улучшающие шаги делать условными, а не обязательными.
- Всегда собирать метрики до и после изменений.
- Приватность делать настройкой “по умолчанию”, а не опцией “на потом”.

## Приватность и безопасность

- Облако и API-ключи не используются.
- Доступен strict local режим (`WHISPERMAC_STRICT_LOCAL=1`) после первичной загрузки модели.
- Можно отключить запись транскриптов в файл (`WHISPERMAC_SAVE_TRANSCRIPTS=0`).

